exports["lqs-react-client"]=(()=>{"use strict";var e={444:(e,t,r)=>{r.r(t),r.d(t,{BackendContext:()=>p,BackendContextConsumer:()=>b,BackendContextProvider:()=>g,useAction:()=>A,useQuery:()=>k});const n=require("react");var o=r.n(n);const i=require("immer"),c=require("socket.io-client");var u=r.n(c);const a=require("fbemitter"),s=require("react-use"),f=require("shortid-36");var l=r.n(f);function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var c,u=e[Symbol.iterator]();!(n=(c=u.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t,r,n,o,i,c){try{var u=e[i](c),a=u.value}catch(e){return void r(e)}u.done?t(a):Promise.resolve(a).then(n,o)}var p=o().createContext();(0,i.enablePatches)();var m=function(e,t,r){var n=new a.EventEmitter;return n.unsubscribe=function(){e.emit("unsubscribe",{id:this.id},r)},setTimeout((function(){try{t((function(t){console.log("creating subscription ",t),n.id=t,e.on(t,(function(e){var t=e.key,r=e.payload;n.emit(t,r)})),e.emit("subscribe",t)}))}catch(e){n.emit("error",e)}}),0),n};function g(e){var t=e.children,r=e.url,i=e.token,c=e.name,a=e.onForbidden,f=d((0,s.useLocalStorage)(c||"lqsdid"),2),v=f[0],g=f[1],b=d((0,n.useState)(),2),h=b[0],S=b[1],w=d((0,n.useState)(),2),q=w[0],k=w[1],x=d((0,n.useState)(),2),O=x[0],A=x[1],j=d((0,n.useState)(),2),E=j[0],P=j[1];(0,n.useEffect)((function(){v||g(l().generate())}),[]),(0,n.useEffect)((function(){if(r&&v){console.log("connecting websocket to backend",r);var e=u()(r,{"reconnection delay":0,"reopen delay":0,"force new connection":!0,query:"id_token=".concat(i,"&did=").concat(v),transports:["websocket"]});e.on("connect",(function(){S(e),k(!0)})),e.on("disconnect",(function(){k(!1)})),e.on("reconnect",(function(){k(!0)})),e.on("client-error",(function(e){console.log("received error",e),A(e),setTimeout((function(){return A(null)}),5e3)})),e.on("forbidden",(function(){a?a():(console.log("received forbidden... let's reload"),window.location.reload())}))}}),[r,v]);var C={socket:h,connected:q,error:O,backend:E};return o().useEffect((function(){h&&P(function(e){return{act:function(t,r,n,o){return(i=regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e.emit("act",{type:r,scope:t,data:n},o);case 1:case"end":return i.stop()}}),i)})),function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function c(e){y(o,r,n,c,u,"next",e)}function u(e){y(o,r,n,c,u,"throw",e)}c(void 0)}))})();var i},query:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,o=(arguments.length>3?arguments[3]:void 0)||{};if(!1!==o.sync)return m(e,(function(n){e.emit("query",{params:r,query:t,scope:o.scope,sortOrder:o.sortOrder,paging:o.paging,sync:!0,single:o.single},n)}),(function(t){e.emit("close-query",{id:t})}));e.emit("query",{params:r,query:t,scope:o.scope,sortOrder:o.sortOrder,paging:o.paging,single:o.single},n)},view:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=(arguments.length>2?arguments[2]:void 0)||{};return m(e,(function(o){e.emit("open-view",{name:t,params:r,scope:n.scope,sortOrder:n.sortOrder,height:n.height,paging:n.paging,sync:!0},o)}),(function(t){e.emit("close-view",{id:t})}))}}}(h))}),[h]),E?o().createElement(p.Provider,{value:C},t):null}var b=p.Consumer;const h=require("react-fast-compare");var S=r.n(h);function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var c,u=e[Symbol.iterator]();!(n=(c=u.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,n.useContext)(p),i=o.backend,c=o.connected,u=(0,n.useState)(),a=w(u,2),s=a[0],f=a[1],l=(0,n.useState)(),d=w(l,2),v=d[0],y=d[1],m=(0,n.useState)(),g=w(m,2),b=g[0],h=g[1],q=(0,n.useState)(t),k=w(q,2),x=k[0],O=k[1],A=(0,n.useState)(r),j=w(A,2),E=j[0],P=j[1],C=(0,n.useMemo)((function(){return i.query(e,x,null,E)}),[e,x,E,i]);return(0,n.useEffect)((function(){S()(x,t)||O(t),S()(E,r)||P(r)}),[t,r]),(0,n.useEffect)((function(){var e=[];if(C)return e.push(C.addListener("data",(function(e){var t=e.data,r=e.total;f(t),y(r)})),C.addListener("error",(function(e){console.error(e),h(e)}))),function(){e.forEach((function(e){return e.remove()})),C.unsubscribe()}}),[C.id]),{data:s,total:v,connected:c,error:b}}const x=require("lodash");function O(e,t,r,n,o,i,c){try{var u=e[i](c),a=u.value}catch(e){return void r(e)}u.done?t(a):Promise.resolve(a).then(n,o)}function A(e,t){var r=(0,n.useContext)(p),o=r.backend,i=r.error,c=r.connected,u=r.socket;return[function(){var r,n=(r=regeneratorRuntime.mark((function r(n,i){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(0,x.isFunction)(t.id)&&(t.id=t.id(n)),r.abrupt("return",o.act(t,e,n,i));case 2:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function c(e){O(i,n,o,c,u,"next",e)}function u(e){O(i,n,o,c,u,"throw",e)}c(void 0)}))});return function(e,t){return n.apply(this,arguments)}}(),i,c,u]}}},t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(444)})();